---
output: github_document
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

<!-- badges: start -->
  [![R-CMD-check](https://github.com/caravagnalab/pkgTemplate/workflows/R-CMD-check/badge.svg)](https://github.com/caravagnalab/pkgTemplate/actions)
[![R-CMD-check](https://github.com/elena-buscaroli/pkgTemplate/workflows/R-CMD-check/badge.svg)](https://github.com/elena-buscaroli/pkgTemplate/actions)
<!-- badges: end -->


## Template for a R Package repository

Content related to the package:

- `DESCRIPTION`: contains information about the package name/description and dependencies. `Imports` is used to import CRAN packages, while dependencies installed otherwise (like from GitHub) must be present also in the `Remotes` field.

- `NAMESPACE`: contains all the imported packages and functions. Automatically generated by `devtools::document()`, should not be modified.

- `man`: contains the manual reference for the exported functions. Automatically generated by `devtools::document()` and files should not be modified.

- `R`: contains all the `R` scripts of the package.


## To create an empty package from RStudio

1. `File`
2. `New Project`
3. `New Directory`
4. `R Package`
5. Set the package name and the location on disk


## Other functions

- `devtools::load_all()` to load the functions without installing the package (from inside the package directory).

- `devtools::document()` to document the package with Roxygen (updating the `NAMESPACE` and the manual).

- `usethis::use_data(trees)` to add an object to the package (in this case the dataset `trees`).

- `pkgdown::build_site()` to build the site locally. Calling `build_site()` will generate a folder `docs` with the `.html` files of the website built locally. 
  If the GitHub Actions workflow to build the website is working (`pkgdown` in this repository), the website will be automatically built each time a change is pushed, so `docs` should be in the `.gitignore` since it is not useful.

- `usethis::use_article("hello")` to create and add an article to the vignette page. This will generate a file `hello.Rmd` in the `vignettes` folder.


## To setup the GitHub actions workflows

For each GitHub actions workflow, a file `.yml` is generated in `.github/workflows/`. The `.yml` contains a set of processes and commands run automatically each time a change is pushed in the repository.

### `R-CMD-check`
`usethis::use_github_action_check_standard()` will create a workflow (with the `.yml` file) for the R CMD check. Each time a change is pushed, it will check check if the package can be build and installed.
*Note*: by default, it will report an error even if only warnings are returned. To report a `fail` in the workflow only if errors are raised, change the last "process" in the `.yml` as follows:

```
  - uses: r-lib/actions/check-r-package@v1
    with:
      error-on: '"error"'
```

### `pkgdown`

From the `usethis` package documentation <https://usethis.r-lib.org/reference/use_pkgdown.html>:

- `usethis::use_pkgdown()`
- `usethis::use_github_pages()`
- `usethis::use_github_action("pkgdown")`

This creates 

- a file `_pkgdown.yml`, in which you need to specify the url to push the site,
- a file `.github/workflows/pkgdown.yaml` with the pipeline of commands that will be run automatically each push, 
- a new branch `gh-pages` that will contain all the html pages of the website.

*Note*: the usage of GitHub pages needs to be activated from "Settings"-> "Pages" of the repository.

After this, two new GitHub Actions workflows (`pkgdown` and `pages-build-deployment`) will be executed each time a change is pushed.


## References

<https://r-pkgs.org/index.html> Good reference to build a R package. In particular the sections `Git and GitHub` and `Automated checking`.

